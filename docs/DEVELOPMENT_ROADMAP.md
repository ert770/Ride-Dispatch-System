# 🗺️ 開發路線圖 (Development Roadmap)

> **版本**: v1.0  
> **最後更新**: 2025-12-26  
> **專案**: Ride-Dispatch-System

---

## 📋 總覽

本文件定義所有 Issues 的**開發順序**、**依賴關係**和**優先等級**，確保團隊高效協作。

### 優先等級說明

| 等級 | 標記 | 說明 |
|-----|------|------|
| P0 | 🔴 緊急 | 阻塞性任務，必須最先完成 |
| P1 | 🟠 高優先 | 核心功能，影響多個下游任務 |
| P2 | 🟡 中優先 | 重要功能，有明確依賴 |
| P3 | 🟢 低優先 | 可並行或最後完成 |

---

## 🔄 開發階段與順序

```
Phase 1: 基礎建設 ──────────────────────────────────────────────┐
│                                                                │
│  [#1] OrderService ─────┬─────────────────────────────────────┼──► Phase 2
│  [#4] DriverService ────┤                                     │
│  [#7] AuditLogService ──┘                                     │
│                                                                │
└────────────────────────────────────────────────────────────────┘

Phase 2: 核心邏輯 ──────────────────────────────────────────────┐
│                                                                │
│  [#2] H2 搶單併發 ──────┬─────────────────────────────────────┼──► Phase 3
│  [#3] H4 冪等性 ────────┤                                     │
│  [#5] 計價系統 ─────────┤                                     │
│  [#6] 配對演算法 ───────┘                                     │
│                                                                │
└────────────────────────────────────────────────────────────────┘

Phase 3: API 層 ────────────────────────────────────────────────┐
│                                                                │
│  [#15] OrderController ─┬─────────────────────────────────────┼──► Phase 4
│  [#16] DriverController ┤                                     │
│  [#17] AdminController ─┘                                     │
│                                                                │
└────────────────────────────────────────────────────────────────┘

Phase 4: 前端 & 測試 (可並行) ──────────────────────────────────┐
│                                                                │
│  [#12] Passenger App ───┬── 前端 ────┐                        │
│  [#13] Driver App ──────┤            │                        │
│  [#14] Admin Console ───┘            ├───────────────────────►│ Done!
│                                      │                        │
│  [#8] 單元測試 ─────────┬── 測試 ────┤                        │
│  [#9] 整合測試 ─────────┤            │                        │
│  [#10] H2 併發測試 ─────┤            │                        │
│  [#11] H4 冪等測試 ─────┘            │                        │
│                                      │                        │
│  [#19] JaCoCo ──────────┬── CI ─────┤                        │
│  [#20] PMD ─────────────┘            │                        │
│                                      │                        │
│  [#18] 系統規格書 ────── 文件 ───────┘                        │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

---

## 📊 Issues 詳細清單

### Phase 1: 基礎建設 (Foundation) ✅ 已完成

> **目標**: 建立核心服務的基礎框架
> **預估時間**: 2-3 天
> **可並行開發**: ✅ 是
> **完成日期**: 2025-12-25

| Issue | 標題 | 優先 | 依賴 | 被依賴 | 狀態 |
|-------|------|------|------|--------|------|
| **#1** | [後端] 完成 OrderService 核心業務邏輯 | 🔴 P0 | 無 | #2, #3, #5, #15, #8 | ✅ 已完成 |
| **#4** | [後端] 實作 DriverService 司機服務 | 🔴 P0 | 無 | #6, #16, #2 | ✅ 已完成 |
| **#7** | [後端] 實作 AuditLogService 審計日誌 | 🔴 P0 | 無 | #2, #17 | ✅ 已完成 |

#### 🔗 Phase 1 依賴圖

```
┌─────────────────────────────────────────────────┐
│                  Phase 1                        │
│                                                 │
│  ┌─────────────┐ ┌─────────────┐ ┌────────────┐│
│  │ #1 Order    │ │ #4 Driver   │ │ #7 Audit   ││
│  │ Service     │ │ Service     │ │ LogService ││
│  │    🔴       │ │    🔴       │ │    🔴      ││
│  └──────┬──────┘ └──────┬──────┘ └─────┬──────┘│
│         │               │              │        │
└─────────┼───────────────┼──────────────┼────────┘
          │               │              │
          ▼               ▼              ▼
      Phase 2         Phase 2        Phase 2
```

---

### Phase 2: 核心邏輯 (Core Logic) ✅ 已完成

> **目標**: 實作併發控制、計價、配對等核心演算法
> **預估時間**: 3-4 天
> **必須等待**: Phase 1 完成
> **可並行開發**: ⚠️ 部分可並行
> **完成日期**: 2025-12-26

| Issue | 標題 | 優先 | 依賴 | 被依賴 | 狀態 |
|-------|------|------|------|--------|------|
| **#2** | [後端] 實作 H2 搶單併發控制 | 🟠 P1 | #1, #4, #7 | #10, #15 | ✅ 已完成 |
| **#3** | [後端] 實作 H4 冪等性控制 | 🟠 P1 | #1 | #11, #15 | ✅ 已完成 |
| **#5** | [後端] 實作計價系統 FareCalculator | 🟠 P1 | #1 | #15, #17 | ✅ 已完成 |
| **#6** | [後端] 實作配對演算法 MatchingService | 🟠 P1 | #4 | #15, #16 | ✅ 已完成 |

#### 🔗 Phase 2 依賴圖

```
         From Phase 1
              │
    ┌─────────┼─────────┐
    │         │         │
    ▼         ▼         ▼
┌───────┐ ┌───────┐ ┌───────┐
│  #1   │ │  #4   │ │  #7   │
└───┬───┘ └───┬───┘ └───┬───┘
    │         │         │
    ├─────────┼─────────┤
    │         │         │
    ▼         ▼         ▼
┌───────────────────────────────────────────────┐
│                  Phase 2                       │
│                                               │
│ ┌────────┐ ┌────────┐ ┌────────┐ ┌──────────┐│
│ │ #2 H2  │ │ #3 H4  │ │ #5     │ │ #6       ││
│ │ 搶單   │ │ 冪等   │ │ 計價   │ │ 配對     ││
│ │  🟠    │ │  🟠    │ │  🟠    │ │  🟠      ││
│ └────────┘ └────────┘ └────────┘ └──────────┘│
│                                               │
└───────────────────────────────────────────────┘
              │
              ▼
          Phase 3
```

---

### Phase 3: API 層 (REST Controllers) ✅ 已完成

> **目標**: 完成所有 REST API 端點
> **預估時間**: 2-3 天
> **必須等待**: Phase 2 完成
> **可並行開發**: ✅ 是 (三個 Controller 可並行)
> **完成日期**: 2025-12-26

| Issue | 標題 | 優先 | 依賴 | 被依賴 | 狀態 |
|-------|------|------|------|--------|------|
| **#15** | [後端] 完成 OrderController REST API | 🟡 P2 | #1, #2, #3, #5, #6 | #12, #13, #9 | ✅ 已完成 |
| **#16** | [後端] 完成 DriverController REST API | 🟡 P2 | #4, #6 | #13, #9 | ✅ 已完成 |
| **#17** | [後端] 完成 AdminController REST API | 🟡 P2 | #5, #7 | #14, #9 | ✅ 已完成 |

#### 🔗 Phase 3 依賴圖

```
         From Phase 2
              │
    ┌─────────┴─────────┐
    │                   │
    ▼                   ▼
┌───────────────────────────────────────────────┐
│                  Phase 3 ✅                    │
│                                               │
│ ┌────────────┐ ┌────────────┐ ┌─────────────┐│
│ │ #15 Order  │ │ #16 Driver │ │ #17 Admin   ││
│ │ Controller │ │ Controller │ │ Controller  ││
│ │    ✅      │ │    ✅      │ │    ✅       ││
│ └─────┬──────┘ └─────┬──────┘ └──────┬──────┘│
│       │              │               │        │
└───────┼──────────────┼───────────────┼────────┘
        │              │               │
        ▼              ▼               ▼
    Phase 4        Phase 4         Phase 4
   (前端+測試)    (前端+測試)      (前端+測試)
```

---

### Phase 4: 前端 & 測試 & 文件 🟢 P3

> **目標**: 完成前端應用、測試套件、CI 設定與文件
> **預估時間**: 4-5 天
> **必須等待**: Phase 3 完成 (API 可呼叫)
> **可並行開發**: ✅ 是 (所有任務可並行)

#### 4A. 前端開發 (JavaFX)

| Issue | 標題 | 優先 | 依賴 | 備註 |
|-------|------|------|------|------|
| **#12** | [前端] 初始化 JavaFX Passenger App | 🟢 P3 | #15 | |
| **#13** | [前端] 初始化 JavaFX Driver App | 🟢 P3 | #15, #16 | |
| **#14** | [前端] 初始化 JavaFX Admin Console | 🟢 P3 | #17 | |

#### 4B. 測試開發 (JUnit)

| Issue | 標題 | 優先 | 依賴 | 備註 |
|-------|------|------|------|------|
| **#8** | [測試] 單元測試 - 狀態機轉換 | 🟡 P2 | #1 | ⚠️ 可提前 |
| **#9** | [測試] 整合測試 - 完整 Happy Path | 🟢 P3 | #15, #16, #17 | |
| **#10** | [測試] 併發測試 - H2 搶單 | 🟢 P3 | #2, #15 | ⭐ 重點驗收 |
| **#11** | [測試] 併發測試 - H4 冪等性 | 🟢 P3 | #3, #15 | ⭐ 重點驗收 |

#### 4C. CI/CD 設定

| Issue | 標題 | 優先 | 依賴 | 備註 |
|-------|------|------|------|------|
| **#19** | [測試] 設定 JaCoCo 測試覆蓋率 | 🟢 P3 | 測試完成後 | |
| **#20** | [測試] 設定 PMD 程式碼品質檢查 | 🟢 P3 | 無 | 可獨立進行 |

#### 4D. 文件

| Issue | 標題 | 優先 | 依賴 | 備註 |
|-------|------|------|------|------|
| **#18** | [文件] 撰寫 SYSTEM_SPEC.md 系統規格書 | 🟢 P3 | 全部完成後 | 報告用 |

---

## 🎯 關鍵路徑 (Critical Path)

> 以下為影響專案完成時間的關鍵路徑，**必須優先處理**

```
#1 OrderService
      │
      ▼
#2 H2 搶單併發 ─────► #15 OrderController ─────► #10 H2 併發測試
      │                      │
      │                      ▼
      │                #9 整合測試
      │                      │
      │                      ▼
      └─────────────► #18 系統規格書 ─────► ✅ 專案完成
```

**關鍵路徑預估時間**: 10-12 天

---

## 📅 建議開發時程

### Sprint 1 (Day 1-3): 基礎建設

| 天 | 任務 | 負責人 |
|----|------|--------|
| Day 1-2 | #1 OrderService 核心邏輯 | 後端 A |
| Day 1-2 | #4 DriverService | 後端 B |
| Day 1-2 | #7 AuditLogService | 後端 A/B |
| Day 3 | 整合測試基礎建設 | 後端 |

### Sprint 2 (Day 4-7): 核心邏輯 + API

| 天 | 任務 | 負責人 |
|----|------|--------|
| Day 4-5 | #2 H2 搶單併發控制 | 後端 A |
| Day 4-5 | #3 H4 冪等性控制 | 後端 A |
| Day 4-5 | #5 計價系統 | 後端 B |
| Day 4-5 | #6 配對演算法 | 後端 B |
| Day 6-7 | #15, #16, #17 Controllers | 後端 A+B |

### Sprint 3 (Day 8-12): 前端 + 測試 + 文件

| 天 | 任務 | 負責人 |
|----|------|--------|
| Day 8-10 | #12, #13, #14 JavaFX Apps | 前端 |
| Day 8-9 | #8, #9 單元/整合測試 | 測試 |
| Day 10-11 | #10, #11 併發測試 | 測試 |
| Day 11-12 | #19, #20 JaCoCo/PMD | DevOps |
| Day 12 | #18 系統規格書 | 全員 |

---

## ⚠️ 風險與注意事項

### 高風險 Issues

| Issue | 風險 | 緩解措施 |
|-------|------|----------|
| #2 H2 搶單 | 併發控制複雜 | 提前設計鎖策略、Code Review |
| #3 H4 冪等性 | 邊界情況多 | 詳細測試案例、TDD 開發 |
| #10 H2 測試 | 難以重現併發問題 | 使用 CountDownLatch、多次執行 |

### 可提前開始的 Issues

以下 Issues 可在依賴完成前開始準備：

| Issue | 可提前做的事 |
|-------|-------------|
| #8 單元測試 | 測試案例設計、測試框架搭建 |
| #12-14 前端 | UI 設計稿、元件框架 |
| #18 系統規格書 | 文件結構、架構圖 |
| #20 PMD | 規則設定 |

---

## 🔗 快速連結

- 📁 [所有 Issues](https://github.com/RRRrrr1212/Ride-Dispatch-System/issues)
- 📖 [狀態機合約](./specs/state-machine.md)
- 📖 [API 規格](./specs/api-spec.md)
- 📖 [README](../README.md)

---

**版本**: v1.0  
**更新日期**: 2025-12-26
